<UserControl x:Class="ProcSim.Views.ProcessesView"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:materialDesign="http://materialdesigninxaml.net/winfx/xaml/themes"
    xmlns:converters="clr-namespace:ProcSim.Converters"
    xmlns:sys="clr-namespace:System;assembly=mscorlib"
    Height="Auto" Width="Auto">

    <UserControl.Resources>
        <Style TargetType="TextBlock">
            <Setter Property="Margin" Value="0,5,5,5"/>
            <Setter Property="VerticalAlignment" Value="Center"/>
        </Style>

        <Style TargetType="TextBox">
            <Setter Property="Margin" Value="0,5,0,5"/>
            <Setter Property="HorizontalAlignment" Value="Left"/>
            <Setter Property="Width" Value="150"/>
        </Style>

        <converters:IsCpuOperationConverter x:Key="IsCpuOperationConverter"/>
        <converters:EnumDescriptionConverter x:Key="EnumDescriptionConverter"/>
        <converters:InvertBooleanConverter x:Key="InvertBooleanConverter"/>
    </UserControl.Resources>

    <Grid Margin="10">
        <Grid.ColumnDefinitions>
            <ColumnDefinition Width="Auto"/>
            <ColumnDefinition Width="10"/>
            <ColumnDefinition Width="Auto"/>
        </Grid.ColumnDefinitions>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="10"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="10"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>
        <materialDesign:Card Grid.Row="0">
            <StackPanel Margin="5">
                <TextBlock Text="Processos" Style="{StaticResource MaterialDesignLabelMediumTextBlock}" />
                <Separator Margin="0,4"/>
                <DataGrid ItemsSource="{Binding Processes}" SelectedItem="{Binding SelectedProcess, Mode=TwoWay}"
                      AutoGenerateColumns="False"
                      CanUserReorderColumns="False"
                      CanUserResizeColumns="False"
                      CanUserSortColumns="False"
                      HeadersVisibility="Column"
                      RowHeaderWidth="0"
                      GridLinesVisibility="None"
                      SelectionMode="Single"
                      BorderThickness="0"
                      Padding="0">

                    <DataGrid.Columns>
                        <DataGridTextColumn Header="Id" Binding="{Binding Id}" Width="Auto" IsReadOnly="True"/>
                        <DataGridTextColumn Header="Nome" Binding="{Binding Name}" Width="Auto" />
                    </DataGrid.Columns>

                    <DataGrid.Resources>
                        <!-- Remove o fundo de seleção -->
                        <SolidColorBrush x:Key="{x:Static SystemColors.HighlightBrushKey}" Color="Transparent"/>
                        <SolidColorBrush x:Key="{x:Static SystemColors.ControlBrushKey}" Color="Transparent"/>
                        <!-- Mantém o texto na cor preta mesmo quando selecionado -->
                        <SolidColorBrush x:Key="{x:Static SystemColors.HighlightTextBrushKey}" Color="Black"/>
                    </DataGrid.Resources>
                </DataGrid>
            </StackPanel>
        </materialDesign:Card>

        <Grid Grid.Row="2">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="80"/>
                <ColumnDefinition Width="Auto"/>
            </Grid.ColumnDefinitions>
        </Grid>
        <materialDesign:Card Grid.Row="0" Grid.Column="2">
            <StackPanel Margin="5">
                <TextBlock Text="Operações" Style="{StaticResource MaterialDesignLabelMediumTextBlock}" />

                <Separator Margin="0,4"/>

                <DataGrid ItemsSource="{Binding SelectedProcess.Operations}"
                      AutoGenerateColumns="False"
                      CanUserReorderColumns="False"
                      CanUserResizeColumns="False"
                      CanUserSortColumns="False"
                      HeadersVisibility="Column"
                      RowHeaderWidth="0"
                      GridLinesVisibility="None"
                      SelectionMode="Single"
                      BorderThickness="0"
                      CanUserAddRows="True"
                      CanUserDeleteRows="True"
                      Padding="0">

                    <DataGrid.Columns>
                        <DataGridTextColumn Header="Duração" Binding="{Binding Duration}" Width="Auto" />
                        <materialDesign:DataGridComboBoxColumn
                            Width="Auto"
                            Header="Tipo"
                            SelectedItemBinding="{Binding IsCpu, Converter={StaticResource IsCpuOperationConverter}, UpdateSourceTrigger=PropertyChanged}">
                            <DataGridComboBoxColumn.ItemsSource>
                                <x:Array Type="{x:Type sys:String}">
                                    <sys:String>CPU</sys:String>
                                    <sys:String>IO</sys:String>
                                </x:Array>
                            </DataGridComboBoxColumn.ItemsSource>
                        </materialDesign:DataGridComboBoxColumn>
                        <materialDesign:DataGridComboBoxColumn
                            Width="Auto"
                            Header="Dispositivo"
                            ItemsSourceBinding="{Binding RelativeSource={RelativeSource FindAncestor, AncestorType={x:Type DataGrid}}, Path=DataContext.IoDeviceTypes, Converter={StaticResource EnumDescriptionConverter}}"
                            SelectedItemBinding="{Binding IoDeviceType, Converter={StaticResource EnumDescriptionConverter}}">
                            <materialDesign:DataGridComboBoxColumn.CellStyle>
                                <Style TargetType="DataGridCell" BasedOn="{StaticResource {x:Type DataGridCell}}">
                                    <Setter Property="IsEnabled" Value="{Binding IsCpu, Converter={StaticResource InvertBooleanConverter}}" />
                                </Style>
                            </materialDesign:DataGridComboBoxColumn.CellStyle>
                        </materialDesign:DataGridComboBoxColumn>
                    </DataGrid.Columns>
                    
                    <DataGrid.Resources>
                        <!-- Remove o fundo de seleção -->
                        <SolidColorBrush x:Key="{x:Static SystemColors.HighlightBrushKey}" Color="Transparent"/>
                        <SolidColorBrush x:Key="{x:Static SystemColors.ControlBrushKey}" Color="Transparent"/>
                        <!-- Mantém o texto na cor preta mesmo quando selecionado -->
                        <SolidColorBrush x:Key="{x:Static SystemColors.HighlightTextBrushKey}" Color="Black"/>
                    </DataGrid.Resources>
                </DataGrid>
            </StackPanel>
        </materialDesign:Card>
        <StackPanel Grid.Row="2" Grid.ColumnSpan="3" Orientation="Horizontal" HorizontalAlignment="Right">
            <Button Content="Save" Command="{Binding SaveCommand}" Width="80" />
            <Separator Width="10" Visibility="Hidden"/>
            <Button Content="Cancel" Command="{Binding CancelCommand}" Width="80"/>
        </StackPanel>
    </Grid>
</UserControl>
