<UserControl x:Class="ProcSim.Views.TaskManagerControl"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:materialDesign="http://materialdesigninxaml.net/winfx/xaml/themes"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008" 
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             xmlns:lvc="clr-namespace:LiveChartsCore.SkiaSharpView.WPF;assembly=LiveChartsCore.SkiaSharpView.WPF"
             xmlns:vm="clr-namespace:ProcSim.ViewModels"
             xmlns:views="clr-namespace:ProcSim.Views"
             xmlns:converters="clr-namespace:ProcSim.Converters" 
             d:DataContext="{d:DesignInstance Type=vm:TaskManagerViewModel}"
             mc:Ignorable="d"
             d:DesignHeight="600"
             d:DesignWidth="800"
             VerticalAlignment="Stretch"
             HorizontalAlignment="Stretch">
    <UserControl.Resources>
        <converters:EnumDescriptionConverter x:Key="EnumDescriptionConverter"/>
        <converters:EqualityToBooleanConverter x:Key="EqualityToBooleanConverter"/>

        <Style x:Key="StaticPriorityCellStyle" TargetType="DataGridCell" BasedOn="{StaticResource MaterialDesignDataGridCell}">
            <Setter Property="IsEnabled" Value="False"/>
            <Style.Triggers>
                <DataTrigger Binding="{Binding IsUserProcess}" Value="True">
                    <Setter Property="IsEnabled" Value="True"/>
                </DataTrigger>
            </Style.Triggers>
        </Style>
    </UserControl.Resources>
    <Grid Margin="16"
            VerticalAlignment="Stretch"
            HorizontalAlignment="Stretch">
        <Grid.RowDefinitions>
            <RowDefinition Height="*" />
        </Grid.RowDefinitions>
        <TabControl Grid.Row="0"
                    materialDesign:ColorZoneAssist.Mode="PrimaryDark"
                    VerticalAlignment="Stretch"
                    HorizontalAlignment="Stretch">
            <TabItem Header="CPU">
                <ScrollViewer HorizontalScrollBarVisibility="Auto" VerticalScrollBarVisibility="Auto">
                    <ItemsControl ItemsSource="{Binding CpuCharts}">
                        <ItemsControl.ItemsPanel>
                            <ItemsPanelTemplate>
                                <UniformGrid Columns="2" />
                            </ItemsPanelTemplate>
                        </ItemsControl.ItemsPanel>
                        <ItemsControl.ItemTemplate>
                            <DataTemplate>
                                <Border Margin="4" 
                                        BorderBrush="Gray"
                                        BorderThickness="1"
                                        Padding="4"
                                        MinHeight="200"
                                        VerticalAlignment="Stretch" 
                                        HorizontalAlignment="Stretch">
                                    <lvc:CartesianChart VerticalAlignment="Stretch"
                                                        HorizontalAlignment="Stretch"
                                                        Series="{Binding Series}"
                                                        XAxes="{Binding XAxes}"
                                                        YAxes="{Binding YAxes}"
                                                        LegendPosition="Left"
                                                        DrawMargin="{Binding Margin}" />
                                </Border>
                            </DataTemplate>
                        </ItemsControl.ItemTemplate>
                    </ItemsControl>
                </ScrollViewer>
            </TabItem>

            <TabItem Header="Dispositivos">
                <ScrollViewer HorizontalScrollBarVisibility="Auto" VerticalScrollBarVisibility="Auto">
                    <ItemsControl ItemsSource="{Binding IoCharts}">
                        <ItemsControl.ItemsPanel>
                            <ItemsPanelTemplate>
                                <UniformGrid Columns="2" />
                            </ItemsPanelTemplate>
                        </ItemsControl.ItemsPanel>
                        <ItemsControl.ItemTemplate>
                            <DataTemplate>
                                <StackPanel Margin="4" 
                                            MinHeight="200"
                                            VerticalAlignment="Stretch" 
                                            HorizontalAlignment="Stretch">
                                    <TextBlock Text="{Binding DeviceName}" FontWeight="Bold" Margin="0,0,0,4"/>
                                    <Border Margin="4" 
                                            BorderBrush="Gray"
                                            BorderThickness="1"
                                            Padding="4"
                                            MinHeight="200"
                                            VerticalAlignment="Stretch" 
                                            HorizontalAlignment="Stretch">
                                        <lvc:CartesianChart VerticalAlignment="Stretch"
                                                            HorizontalAlignment="Stretch"
                                                            Series="{Binding Series}"
                                                            XAxes="{Binding XAxes}"
                                                            YAxes="{Binding YAxes}"
                                                            DrawMargin="{Binding Margin}" />
                                    </Border>
                                    <TextBlock Text="{Binding AdditionalInfo}" 
                                               FontStyle="Italic" 
                                               FontSize="12" 
                                               Foreground="Gray" 
                                               Margin="0,4,0,0"/>
                                </StackPanel>
                            </DataTemplate>
                        </ItemsControl.ItemTemplate>
                    </ItemsControl>
                </ScrollViewer>
            </TabItem>

            <TabItem Header="Detalhes">
                <Grid VerticalAlignment="Stretch"
                      HorizontalAlignment="Stretch">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="1.5*" />
                        <ColumnDefinition Width="*" />
                    </Grid.ColumnDefinitions>
                    <DataGrid Grid.Column="0"
                              ItemsSource="{Binding RunningProcessesDetails}"
                              SelectedItem="{Binding SelectedProcess}"
                              AutoGenerateColumns="False"
                              CanUserReorderColumns="False"
                              CanUserResizeColumns="False"
                              HeadersVisibility="Column"
                              CanUserAddRows="False"
                              CanUserDeleteRows="False"
                              GridLinesVisibility="None"
                              SelectionMode="Single"
                              SelectionUnit="FullRow"
                              BorderThickness="0"
                              Padding="0"
                              RowHeight="33"
                              IsReadOnly="False"
                              Background="White"
                              ScrollViewer.CanContentScroll="True"                 
                              ScrollViewer.VerticalScrollBarVisibility="Auto" >
                        <DataGrid.Columns>
                            <materialDesign:DataGridTextColumn Header="Nome" Binding="{Binding Name}" Width="Auto" IsReadOnly="True"/>
                            <materialDesign:DataGridTextColumn Header="PID" Binding="{Binding Pid}" Width="Auto" IsReadOnly="True"/>
                            <materialDesign:DataGridTextColumn Header="Status" Binding="{Binding State, Converter={StaticResource EnumDescriptionConverter}}" Width="Auto" IsReadOnly="True" />
                            <materialDesign:DataGridTextColumn Header="CPU" Binding="{Binding Cpu}" Width="Auto" IsReadOnly="True"/>
                            <materialDesign:DataGridComboBoxColumn Header="Pr. est."
                                                                   ItemsSource="{Binding Source={x:Static vm:TaskManagerViewModel.ProcessStaticPriorityValues}, Converter={StaticResource EnumDescriptionConverter}}"
                                                                   SelectedItemBinding="{Binding StaticPriority, Converter={StaticResource EnumDescriptionConverter}, UpdateSourceTrigger=PropertyChanged}"
                                                                   Width="Auto"
                                                                   IsReadOnly="False"
                                                                   CellStyle="{StaticResource StaticPriorityCellStyle}"/>
                            <materialDesign:DataGridTextColumn Header="Pr. din." Binding="{Binding DynamicPriority}" Width="Auto" IsReadOnly="True"/>
                        </DataGrid.Columns>
                        <DataGrid.CellStyle>
                            <Style TargetType="DataGridCell" BasedOn="{StaticResource MaterialDesignDataGridCell}">
                                <Setter Property="FocusVisualStyle" Value="{x:Null}" />
                                <Setter Property="BorderThickness" Value="0" />
                                <!--<Style.Triggers>
                                    <Trigger Property="IsSelected" Value="True">
                                        <Setter Property="BorderThickness" Value="0" />
                                    </Trigger>
                                </Style.Triggers>-->
                            </Style>
                        </DataGrid.CellStyle>
                    </DataGrid>
                    <DataGrid Grid.Column="1"
                            ItemsSource="{Binding TerminatedProcessesDetails}"
                            AutoGenerateColumns="False"
                            CanUserReorderColumns="False"
                            CanUserResizeColumns="False"
                            HeadersVisibility="Column"
                            CanUserAddRows="False"
                            CanUserDeleteRows="False"
                            GridLinesVisibility="None"
                            SelectionMode="Single"
                            SelectionUnit="FullRow"
                            BorderThickness="0"
                            Padding="0"
                            RowHeight="33"
                            IsReadOnly="True"
                            Background="White"
                            ScrollViewer.CanContentScroll="True"                 
                            ScrollViewer.VerticalScrollBarVisibility="Auto" >
                        <DataGrid.Columns>
                            <materialDesign:DataGridTextColumn Header="Nome" Binding="{Binding Name}" Width="Auto" />
                            <materialDesign:DataGridTextColumn Header="PID" Binding="{Binding Pid}" Width="Auto" />
                            <materialDesign:DataGridTextColumn Header="Status" Binding="{Binding State, Converter={StaticResource EnumDescriptionConverter}}" Width="Auto" />
                            <materialDesign:DataGridTextColumn Header="CPU" Binding="{Binding Cpu}" Width="Auto" />
                        </DataGrid.Columns>
                        <DataGrid.CellStyle>
                            <Style TargetType="DataGridCell" BasedOn="{StaticResource MaterialDesignDataGridCell}">
                                <Setter Property="FocusVisualStyle" Value="{x:Null}" />
                                <Setter Property="BorderThickness" Value="0" />
                                <Style.Triggers>
                                    <Trigger Property="IsSelected" Value="True">
                                        <Setter Property="BorderThickness" Value="0" />
                                        <Setter Property="Background" Value="{DynamicResource MaterialDesignDataGridCellHoverBackground}" />
                                    </Trigger>
                                </Style.Triggers>
                            </Style>
                        </DataGrid.CellStyle>
                    </DataGrid>
                </Grid>
            </TabItem>

            <!-- Aba Informações Adicionais: apresenta dados do sistema, como CPU, memória, etc.
                 Essa seção pode ser ajustada conforme as informações disponíveis no seu SystemInfoViewModel. -->
            <TabItem Header="Informações">
                <StackPanel Margin="8">
                    <TextBlock Text="Informações do Sistema" FontWeight="Bold" FontSize="16" Margin="0,0,0,8"/>
                    <!-- Exemplo: se TaskManagerViewModel tiver uma propriedade SystemInfo do tipo SystemInfoViewModel -->
                    <TextBlock Text="{Binding SystemInfo.ProcessorName}" FontSize="14"/>
                    <TextBlock Text="{Binding SystemInfo.BaseSpeed}" FontSize="14"/>
                    <TextBlock Text="{Binding SystemInfo.CoreCount, StringFormat='Cores: {0}'}" FontSize="14"/>
                    <TextBlock Text="{Binding SystemInfo.LogicalProcessorCount, StringFormat='Logical Processors: {0}'}" FontSize="14"/>
                    <!-- Adicione outras informações conforme necessário -->
                </StackPanel>
            </TabItem>
        </TabControl>
    </Grid>
</UserControl>